<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simulación Hidrostática</title>

<style>
    body {
        background: #18122B;
        font-family: Arial, sans-serif;
        color: #eee;
        margin: 0;
        padding: 20px;
    }

    h1 {
        text-align: center;
        margin-bottom: 20px;
        color: #c9afff;
    }

    .card {
        background: #2a2340;
        padding: 20px;
        border-radius: 12px;
        max-width: 900px;
        margin: 0 auto 35px auto;
        box-shadow: 0 0 15px #00000040;
    }

    label {
        display: block;
        margin-top: 10px;
        color: #d0c9ff;
    }

    input {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border-radius: 6px;
        border: none;
        outline: none;
        background: #3b335a;
        color: #fff;
        font-size: 15px;
    }

    button {
        margin-top: 20px;
        width: 100%;
        background: #6d5dd6;
        color: white;
        border: none;
        padding: 12px;
        font-size: 16px;
        border-radius: 6px;
        cursor: pointer;
    }

    button:hover {
        background: #7d6df0;
    }

    #results {
        margin-top: 20px;
        padding: 10px;
        background: #352d52;
        border-radius: 10px;
        font-size: 16px;
    }

    canvas {
        display: block;
        margin: 25px auto;
        background: #221a35;
        border-radius: 14px;
        box-shadow: inset 0 0 40px #00000060;
    }

    .subtitle {
        text-align: center;
        margin-top: -15px;
        font-size: 14px;
        color: #bfb8e5;
    }
</style>
</head>

<body>

<h1>Simulación de Presión Hidrostática</h1>

<div class="card">
    <label>Densidad ρ (kg/m³):</label>
    <input type="number" id="rho" value="1000">

    <label>Gravedad g (m/s²):</label>
    <input type="number" id="g" value="9.81">

    <label>Profundidad h (m):</label>
    <input type="number" id="h" value="2">

    <label>Área A (m²):</label>
    <input type="number" id="A" value="1">

    <button onclick="startSimulation()">Iniciar Simulación</button>

    <div id="results"></div>
</div>

<canvas id="tankCanvas" width="500" height="300"></canvas>
<p class="subtitle">Tanque de Agua en Llenado</p>

<canvas id="chartCanvas" width="500" height="300"></canvas>
<p class="subtitle">Curva: Presión vs Profundidad</p>

<script>

// =============================
//   VARIABLES GLOBALES
// =============================
let animProgress = 0;
let animRunning = false;
let lastTimestamp = 0;
let animDuration = 4000; // 4 segundos animación

// =============================
//   INICIAR SIMULACIÓN
// =============================
function startSimulation() {
    const rho = parseFloat(document.getElementById('rho').value);
    const g = parseFloat(document.getElementById('g').value);
    const h = parseFloat(document.getElementById('h').value);
    const A = parseFloat(document.getElementById('A').value);

    const P = rho * g * h + 101325;
    const F = rho * g * h * A;
    const centroid = h / 2;

    document.getElementById('results').innerHTML = `
        <b>Presión a ${h} m:</b> ${P.toFixed(0)} Pa <br>
        <b>Fuerza sobre la superficie:</b> ${F.toFixed(2)} N <br>
        <b>Profundidad del centroide:</b> ${centroid.toFixed(2)} m
    `;

    // Reiniciar animación
    animProgress = 0;
    animRunning = true;
    lastTimestamp = 0;

    requestAnimationFrame(updateAnimation);
}

// =============================
//   ACTUALIZACIÓN ANIMADA
// =============================
function updateAnimation(timestamp) {
    if (!animRunning) return;
    if (!lastTimestamp) lastTimestamp = timestamp;

    const dt = timestamp - lastTimestamp;
    lastTimestamp = timestamp;

    animProgress += dt / animDuration;
    if (animProgress >= 1) {
        animProgress = 1;
        animRunning = false;
    }

    drawTank(animProgress);
    drawChart(animProgress);

    if (animRunning) requestAnimationFrame(updateAnimation);
}

// =============================
//   DIBUJO DEL TANQUE
// =============================
function drawTank(progress) {
    const canvas = document.getElementById("tankCanvas");
    const ctx = canvas.getContext("2d");

    const w = canvas.width;
    const h = canvas.height;

    ctx.clearRect(0, 0, w, h);

    ctx.fillStyle = "#160f29";
    ctx.fillRect(50, 20, 400, 260);

    const waterHeight = 260 * progress;

    ctx.fillStyle = "#4ba3ff";
    ctx.fillRect(50, 280 - waterHeight, 400, waterHeight);

    ctx.strokeStyle = "#ffffff";
    ctx.strokeRect(50, 20, 400, 260);
}

// =============================
//   GRÁFICO PRESIÓN VS PROFUNDIDAD
// =============================
function drawChart(progress) {
    const canvas = document.getElementById("chartCanvas");
    const ctx = canvas.getContext("2d");

    const w = canvas.width;
    const h = canvas.height;

    ctx.clearRect(0, 0, w, h);

    const rho = parseFloat(document.getElementById('rho').value);
    const g = parseFloat(document.getElementById('g').value);
    const H = parseFloat(document.getElementById('h').value);

    const P0 = 101325; // Atmosférica
    const depthNow = H * progress;

    const ml = 60, mr = 30, mt = 40, mb = 40;
    const pw = w - ml - mr;
    const ph = h - mt - mb;

    ctx.strokeStyle = "#dddddd33";
    ctx.lineWidth = 1;

    for (let i = 0; i <= 5; i++) {
        const y = mt + (ph / 5) * i;
        ctx.beginPath();
        ctx.moveTo(ml, y);
        ctx.lineTo(ml + pw, y);
        ctx.stroke();
    }

    ctx.strokeStyle = "#7d6df0";
    ctx.lineWidth = 3;
    ctx.beginPath();

    const steps = 50;
    for (let i = 0; i <= steps; i++) {
        const frac = i / steps;
        const depth = depthNow * frac;
        const P = P0 + rho * g * depth;

        const x = ml + frac * pw;
        const fracY = (P - P0) / (rho * g * H);
        const y = mt + fracY * ph;

        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
    }
    ctx.stroke();

    // ======== PUNTO QUE SE MUEVE ========
    const Ppoint = P0 + rho * g * depthNow;
    const fracX = depthNow / H;
    const fracY = (Ppoint - P0) / (rho * g * H);

    const Px = ml + fracX * pw;
    const Py = mt + fracY * ph;

    ctx.fillStyle = "#ffffff";
    ctx.beginPath();
    ctx.arc(Px, Py, 6, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#ffffff";
    ctx.font = "12px Arial";
    ctx.fillText(Ppoint.toFixed(0) + " Pa", Px + 10, Py - 10);

    // Etiquetas de ejes
    ctx.fillStyle = "#ddd";
    ctx.font = "13px Arial";
    ctx.fillText("Profundidad (m)", w / 2 - 50, h - 10);
    ctx.save();
    ctx.translate(20, h / 2 + 20);
    ctx.rotate(-Math.PI / 2);
    ctx.fillText("Presión (Pa)", 0, 0);
    ctx.restore();
}

</script>

</body>
</html>
