<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulador Hidrostático</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: #0d1117;
      color: #e2e8f0;
      font-family: Arial, sans-serif;
    }
    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 10px;
      padding: 16px;
    }
  </style>
</head>

<body class="p-6">

<h1 class="text-3xl font-bold mb-6 text-center">Simulador Hidrostático Profesional</h1>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

  <!-- Panel -->
  <div class="card">
    <h2 class="text-xl font-bold mb-3">Parámetros</h2>

    <label>ρ (kg/m³)</label>
    <input id="rho" type="number" class="w-full p-2 rounded bg-gray-800 border border-gray-600 mb-3" value="1000">

    <label>g (m/s²)</label>
    <input id="g" type="number" class="w-full p-2 rounded bg-gray-800 border border-gray-600 mb-3" value="9.81">

    <label>h (m)</label>
    <input id="h" type="number" class="w-full p-2 rounded bg-gray-800 border border-gray-600 mb-3" value="2">

    <label>A (m²)</label>
    <input id="A" type="number" class="w-full p-2 rounded bg-gray-800 border border-gray-600 mb-3" value="1">

    <label class="block mt-4">Velocidad de llenado</label>
    <input id="speed" type="range" min="0.2" max="3" step="0.1" value="1" class="w-full">
    <p class="mt-1 text-sm opacity-80">Velocidad: <span id="speedTxt">1.00x</span></p>

    <button id="startBtn" class="w-full mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded">Iniciar</button>
    <button id="resetBtn" class="w-full mt-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded">Reiniciar</button>
  </div>

  <!-- Visual -->
  <div class="lg:col-span-2 flex flex-col gap-6">

    <!-- Tanque -->
    <div class="card">
      <h2 class="text-lg font-bold mb-2">Simulación del Tanque</h2>
      <canvas id="tankCanvas" class="w-full h-[350px] rounded"></canvas>
    </div>

    <!-- Gráfico de presión -->
    <div class="card">
      <h2 class="text-lg font-bold mb-2">Gráfico: Presión vs Profundidad</h2>
      <canvas id="chartCanvas" class="w-full h-[300px]"></canvas>
    </div>

    <!-- Resultados -->
    <div class="card">
      <h2 class="text-lg font-bold mb-2">Resultados</h2>
      <p><strong>Presión en la base:</strong> <span id="Pout">0</span> Pa</p>
      <p><strong>Fuerza total:</strong> <span id="Fout">0</span> N</p>
      <p><strong>Centroide:</strong> <span id="HCout">0</span> m</p>
      <p class="mt-2 opacity-70 text-sm">Valores actualizados en tiempo real durante la simulación.</p>
    </div>

  </div>
</div>

<script>
/* ------------------------------
   Referencias a elementos
------------------------------*/
const rhoEl = document.getElementById("rho");
const gEl   = document.getElementById("g");
const hEl   = document.getElementById("h");
const AEl   = document.getElementById("A");
const speedEl = document.getElementById("speed");

const speedTxt = document.getElementById("speedTxt");
const Pout = document.getElementById("Pout");
const Fout = document.getElementById("Fout");
const HCout = document.getElementById("HCout");

const tankCanvas = document.getElementById("tankCanvas");
const tctx = tankCanvas.getContext("2d");

let level = 0;
let running = false;

/* ------------------------------
   Actualizar texto velocidad
------------------------------*/
speedEl.addEventListener("input", () => {
  speedTxt.textContent = parseFloat(speedEl.value).toFixed(2) + "x";
});

/* ------------------------------
   Gráfico
------------------------------*/
const chartCtx = document.getElementById("chartCanvas").getContext("2d");

let chart = new Chart(chartCtx, {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "Presión (Pa)",
      data: [],
      borderColor: "#4ade80",
      backgroundColor: "rgba(74,222,128,0.2)",
      borderWidth: 3,
      tension: 0.25
    }]
  },
  options: {
    responsive: true,
    scales: {
      x: {
        ticks: { color: "#cbd5e1" }
      },
      y: {
        ticks: { color: "#cbd5e1" }
      }
    }
  }
});

/* ------------------------------
   Dibujar tanque
------------------------------*/
function drawTank() {
  const W = tankCanvas.width = tankCanvas.clientWidth;
  const H = tankCanvas.height = tankCanvas.clientHeight;

  const fluidH = (level / parseFloat(hEl.value)) * (H * 0.85);
  const tankTop = H * 0.1;

  tctx.clearRect(0, 0, W, H);

  // Contorno
  tctx.strokeStyle = "#64748b";
  tctx.lineWidth = 4;
  tctx.strokeRect(W * 0.2, tankTop, W * 0.4, H * 0.85);

  // Fluido
  const grad = tctx.createLinearGradient(0, tankTop, 0, tankTop + fluidH);
  grad.addColorStop(0, "#2563eb");
  grad.addColorStop(1, "#1d4ed8");

  tctx.fillStyle = grad;
  tctx.fillRect(W * 0.2, tankTop + (H * 0.85 - fluidH), W * 0.4, fluidH);
}

/* ------------------------------
   Física
------------------------------*/
function compute() {
  const rho = parseFloat(rhoEl.value);
  const g = parseFloat(gEl.value);
  const h = parseFloat(hEl.value);
  const A = parseFloat(AEl.value);

  const P0 = 101325;
  const P = P0 + rho * g * level;
  const hc = level / 2;
  const F = rho * g * hc * A;

  Pout.textContent = Math.round(P);
  Fout.textContent = F.toFixed(2);
  HCout.textContent = hc.toFixed(2);

  updateChart(rho, g, h, P0);
}

/* ------------------------------
   Actualizar gráfico
------------------------------*/
function updateChart(rho, g, h, P0) {
  const N = 30;
  const labels = [];
  const values = [];

  for (let i = 0; i <= N; i++) {
    const d = (i / N) * level;
    labels.push(d.toFixed(2));
    values.push(P0 + rho * g * d);
  }

  chart.data.labels = labels;
  chart.data.datasets[0].data = values;
  chart.update();
}

/* ------------------------------
   Animación
------------------------------*/
function animate() {
  if (!running) return;

  const speed = parseFloat(speedEl.value);
  const h = parseFloat(hEl.value);

  level += 0.01 * speed;
  if (level >= h) level = h;

  drawTank();
  compute();

  if (level < h) requestAnimationFrame(animate);
}

/* ------------------------------
   Botones
------------------------------*/
document.getElementById("startBtn").onclick = () => {
  running = true;
  animate();
};

document.getElementById("resetBtn").onclick = () => {
  running = false;
  level = 0;
  drawTank();
  compute();
};

/* Inicialización */
drawTank();
compute();

</script>

</body>
</html>

