<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Simulador Hidrost√°tico ‚Äî Dark Purple Soft</title>
<style>
  :root{
    --bg1: #120c20;
    --bg2: #1d1433;
    --panel: #2a2040;
    --panel-2: #342745;
    --muted: #bfb4d9;
    --muted-2: #a899c6;
    --text: #efe9ff;
    --accent: #9ab3ff;
    --accent-2: #7df0c8;
    --force: #ff85b5;
    --glow: rgba(157,114,200,0.14);
    --shadow: 0 10px 30px rgba(10,8,18,0.6);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    min-height:100vh;
    background: linear-gradient(180deg,var(--bg1),var(--bg2));
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:20px;
  }

  .app{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:320px 1fr;gap:20px}
  .panel{background:linear-gradient(180deg,var(--panel),var(--panel-2));border-radius:12px;padding:16px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,0.03)}
  .sidebar{height:calc(100vh - 40px);overflow:auto}
  h1{margin:0;font-size:18px;color:var(--text)}
  .muted{color:var(--muted);font-size:13px}
  .control{margin-top:12px}
  label{display:block;font-weight:600;font-size:13px;margin-bottom:6px;color:var(--muted-2)}
  input[type=number]{width:100%;padding:9px;border-radius:9px;border:1px solid rgba(255,255,255,0.04);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:var(--text)}
  input[type=range]{width:100%}
  .buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  button{cursor:pointer;border:0;padding:9px 12px;border-radius:9px;font-weight:700;background:transparent;color:var(--text)}
  .btn-primary{background:linear-gradient(90deg,var(--accent),#7fb8ff);color:#0b1b2b;box-shadow:0 6px 18px rgba(55,95,195,0.12)}
  .btn-soft{background:rgba(125,240,200,0.12);color:var(--accent-2)}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
  .small{font-size:13px;color:var(--muted)}
  .main{display:flex;flex-direction:column;gap:14px}
  .canvas-area{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
  #visCanvas{width:100%;height:460px;border-radius:10px;background:linear-gradient(180deg,#1b1230,#26173f)}
  #chartCanvas{width:360px;height:260px;border-radius:10px;background:linear-gradient(180deg,#241533,#2d1a3b)}
  .results{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  .result-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .result-card .label{font-size:12px;color:var(--muted-2)}
  .result-card .value{font-weight:800;font-size:18px;color:var(--text)}
  footer.small{color:var(--muted);margin-top:12px}
  .hint{font-size:12px;color:var(--muted);margin-top:8px}
  @media(max-width:980px){
    .app{grid-template-columns:1fr;padding:12px}
    .sidebar{height:auto;order:2}
    .main{order:1}
    #chartCanvas{width:100%}
  }
</style>
</head>
<body>
  <div class="app">

    <!-- SIDEBAR -->
    <aside class="panel sidebar">
      <h1>Simulador Hidrost√°tico ‚Äî Educativo</h1>
      <p class="muted" style="margin-top:6px">
        Simulaci√≥n din√°mica con curva P(h), presiones animadas y fuerza resultante.
      </p>

      <div class="control">
        <label>Densidad œÅ (kg/m¬≥)</label>
        <input id="rho" type="number" value="1000">
      </div>

      <div class="control">
        <label>Gravedad g (m/s¬≤)</label>
        <input id="g" type="number" value="9.81">
      </div>

      <div class="control">
        <label>Altura objetivo h (m)</label>
        <input id="h" type="number" value="2">
      </div>

      <div class="control">
        <label>√Årea A (m¬≤)</label>
        <input id="area" type="number" value="1">
      </div>

      <div class="control">
        <label>Resoluci√≥n</label>
        <input id="steps" type="range" min="8" max="120" value="40">
      </div>

      <div class="control">
        <label>Velocidad</label>
        <input id="speed" type="range" min="0.25" max="3" value="1" step="0.05">
        <div class="small">Velocidad: <span id="speedTxt">1.00x</span></div>
      </div>

      <div class="buttons">
        <button id="case1" class="btn-primary">Caso 1</button>
        <button id="case2" class="btn-soft">Caso 2</button>
      </div>

      <div class="buttons">
        <button id="start" class="btn-primary">Iniciar</button>
        <button id="pause" class="btn-ghost">Pausar</button>
        <button id="reset" class="btn-ghost">Reiniciar</button>
      </div>

      <div class="buttons">
        <button id="download" class="btn-soft">Descargar imagen</button>
        <button id="copy" class="btn-ghost">Copiar par√°metros</button>
      </div>

      <footer class="small">Hecho para LRPD ¬∑ 2025</footer>
    </aside>

    <!-- MAIN AREA -->
    <main class="panel main">
      <div class="canvas-area">
        <div style="flex:1">
          <canvas id="visCanvas"></canvas>
          <div style="display:flex;justify-content:space-between;margin-top:10px" class="small">
            <div>Nivel: <strong id="lvl">0.00 m</strong></div>
            <div>Presi√≥n base: <strong id="pbase">101325 Pa</strong></div>
          </div>
        </div>

        <div style="width:360px">
          <canvas id="chartCanvas"></canvas>
          <div class="small" style="margin-top:8px">Curva: Presi√≥n vs Profundidad</div>
        </div>
      </div>

      <div class="results">
        <div class="result-card">
          <div class="label">Presi√≥n base</div>
          <div id="resP" class="value">‚Äî</div>
        </div>
        <div class="result-card">
          <div class="label">Fuerza total (F)</div>
          <div id="resF" class="value">‚Äî</div>
        </div>
        <div class="result-card">
          <div class="label">Centroide (h/2)</div>
          <div id="resHc" class="value">‚Äî</div>
        </div>
        <div class="result-card">
          <div class="label">Par√°metros</div>
          <div id="resParams" class="small">‚Äî</div>
        </div>
      </div>
    </main>
  </div>

<script>
/* ---------------------------------------------------
   üìå PARTE 2 ‚Äî Variables principales + utilidades
----------------------------------------------------*/

const P0 = 101325; // presi√≥n atm

// Obtener elementos del DOM
const rhoEl = document.getElementById("rho");
const gEl = document.getElementById("g");
const hEl = document.getElementById("h");
const areaEl = document.getElementById("area");
const stepsEl = document.getElementById("steps");
const speedEl = document.getElementById("speed");

const speedTxt = document.getElementById("speedTxt");
const lvlEl = document.getElementById("lvl");
const pbaseEl = document.getElementById("pbase");

const resP = document.getElementById("resP");
const resF = document.getElementById("resF");
const resHc = document.getElementById("resHc");
const resParams = document.getElementById("resParams");

const case1Btn = document.getElementById("case1");
const case2Btn = document.getElementById("case2");
const startBtn = document.getElementById("start");
const pauseBtn = document.getElementById("pause");
const resetBtn = document.getElementById("reset");
const downloadBtn = document.getElementById("download");
const copyBtn = document.getElementById("copy");

// Canvas
const visCanvas = document.getElementById("visCanvas");
const chartCanvas = document.getElementById("chartCanvas");
const visCtx = visCanvas.getContext("2d");
const chartCtx = chartCanvas.getContext("2d");

// Estado de simulaci√≥n
let currentLevel = 0;
let targetLevel = 0;
let animating = false;
let lastTime = 0;

/* ---------------------------------------------------
   üìå Funci√≥n para leer par√°metros sin duplicar variables
----------------------------------------------------*/
function readParams() {
  return {
    rho: parseFloat(rhoEl.value) || 0,
    g: parseFloat(gEl.value) || 0,
    h: parseFloat(hEl.value) || 0,
    area: parseFloat(areaEl.value) || 0,
    steps: parseInt(stepsEl.value),
    speed: parseFloat(speedEl.value),
  };
}

/* ---------------------------------------------------
   üìå Actualizar texto de velocidad
----------------------------------------------------*/
speedEl.addEventListener("input", () => {
  speedTxt.textContent = parseFloat(speedEl.value).toFixed(2) + "x";
});

/* ---------------------------------------------------
   üìå Cargar casos predefinidos
----------------------------------------------------*/
case1Btn.addEventListener("click", () => {
  rhoEl.value = 1000;
  gEl.value = 9.81;
  hEl.value = 2;
  areaEl.value = 1;
  stepsEl.value = 40;
  speedEl.value = 1;
  speedTxt.textContent = "1.00x";
  updateResultsInstant();
});

case2Btn.addEventListener("click", () => {
  rhoEl.value = 850;
  gEl.value = 9.81;
  hEl.value = 1.5;
  areaEl.value = 0.8;
  stepsEl.value = 40;
  speedEl.value = 1;
  speedTxt.textContent = "1.00x";
  updateResultsInstant();
});

/* ---------------------------------------------------
   üìå Botones de simulaci√≥n
----------------------------------------------------*/
startBtn.addEventListener("click", () => {
  const { h } = readParams();
  targetLevel = h;
  animating = true;
});

pauseBtn.addEventListener("click", () => {
  animating = false;
});

resetBtn.addEventListener("click", () => {
  animating = false;
  currentLevel = 0;
  lvlEl.textContent = "0.00 m";
  pbaseEl.textContent = `${P0} Pa`;
  drawSimulation(0);
});

/* ---------------------------------------------------
   üìå Bot√≥n copiar par√°metros
----------------------------------------------------*/
copyBtn.addEventListener("click", () => {
  const p = readParams();
  const txt =
    `œÅ=${p.rho} kg/m¬≥, g=${p.g}, h=${p.h} m, A=${p.area} m¬≤, steps=${p.steps}`;
  navigator.clipboard.writeText(txt);
});

/* ---------------------------------------------------
   üìå Bot√≥n descargar imagen
----------------------------------------------------*/
downloadBtn.addEventListener("click", () => {
  const link = document.createElement("a");
  link.download = "simulacion_hidrostatica.png";
  link.href = visCanvas.toDataURL("image/png");
  link.click();
});

/* ---------------------------------------------------
   üìå Resultados matem√°ticos instant√°neos
----------------------------------------------------*/
function updateResultsInstant() {
  const { rho, g, h, area } = readParams();

  const P = P0 + rho * g * h;
  const hc = h / 2;
  const F = rho * g * hc * area;

  resP.textContent = Math.round(P) + " Pa";
  resF.textContent = F.toFixed(2) + " N";
  resHc.textContent = hc.toFixed(2) + " m";

  resParams.textContent =
    `œÅ=${rho}, g=${g}, h=${h}, A=${area}`;
}
/* ---------------------------------------------------
   üìå PARTE 3 ‚Äî Dibujado + Gr√°ficos + Animaci√≥n
----------------------------------------------------*/

/* ================================
   Funciones de f√≠sica
================================ */
function pressureAt(depth, rho, g) {
  return P0 + rho * g * depth;
}

function totalForce(rho, g, h, A) {
  return rho * g * (h / 2) * A;
}

/* ================================
   Funci√≥n principal de dibujado
================================ */
function drawSimulation(level) {
  const p = readParams();
  const { rho, g, h, area, steps } = p;

  const W = visCanvas.width;
  const H = visCanvas.height;

  visCtx.clearRect(0, 0, W, H);

  const DPR = window.devicePixelRatio || 1;

  // Layout general
  const pad = 30 * DPR;
  const tankX = pad;
  const tankY = pad;
  const tankW = W * 0.45;
  const tankH = H - pad * 2;

  // Contenedor
  visCtx.fillStyle = "#1d1433";
  roundRect(visCtx, tankX, tankY, tankW, tankH, 10 * DPR);
  visCtx.fill();

  // L√≠neas internas (grid)
  visCtx.fillStyle = "rgba(255,255,255,0.05)";
  for (let i = 0; i < steps; i++) {
    const y = tankY + (i / steps) * tankH;
    visCtx.fillRect(tankX + 10 * DPR, y, tankW - 20 * DPR, 1 * DPR);
  }

  // Nivel actual
  const frac = h === 0 ? 0 : level / h;
  const fillH = frac * tankH;

  // Agua
  if (fillH > 0) {
    const yTop = tankY + tankH - fillH;

    const grad = visCtx.createLinearGradient(0, yTop, 0, yTop + fillH);
    grad.addColorStop(0, "rgba(90,150,255,0.28)");
    grad.addColorStop(1, "rgba(40,90,210,0.35)");

    visCtx.fillStyle = grad;
    roundRect(visCtx, tankX, yTop, tankW, fillH, 10 * DPR);
    visCtx.fill();
  }

  /* ----------------------------------------
     Barra de presi√≥n (lado derecho)
  ---------------------------------------- */
  const barX = tankX + tankW + 30 * DPR;
  const barW = W * 0.25;

  for (let i = 0; i <= steps; i++) {
    const dfrac = i / steps;
    const depth = dfrac * h;
    const P = pressureAt(depth, rho, g);

    const rel = h === 0 ? 0 : depth / h;
    const bw = rel * barW * frac;

    const y = tankY + dfrac * tankH;

    visCtx.fillStyle = "rgba(255,255,255,0.18)";
    roundRect(visCtx, barX, y - 3 * DPR, bw, 6 * DPR, 3 * DPR);
    visCtx.fill();

    if (i % Math.ceil(steps / 5) === 0) {
      visCtx.fillStyle = "#eee";
      visCtx.font = `${11 * DPR}px Inter`;
      visCtx.fillText(`${depth.toFixed(2)} m`, barX + bw + 10, y - 6);
      visCtx.fillText(`${Math.round(P)} Pa`, barX + bw + 90, y - 6);
    }
  }

  /* ----------------------------------------
     Fuerza (flecha)
  ---------------------------------------- */
  const F = totalForce(rho, g, h, area);
  const Fcur = totalForce(rho, g, level, area);
  const maxArrow = Math.min(W * 0.22, 280 * DPR);
  const arrow = F === 0 ? 0 : (Fcur / F) * maxArrow;

  const cpDepth = level / 2;
  const cpY = tankY + tankH - (cpDepth / Math.max(h, 0.001)) * tankH;

  const ax0 = barX + barW + 30 * DPR;
  visCtx.strokeStyle = "#ff85b5";
  visCtx.lineWidth = 3 * DPR;

  visCtx.beginPath();
  visCtx.moveTo(ax0, cpY);
  visCtx.lineTo(ax0 + arrow, cpY);
  visCtx.stroke();

  // Punta flecha
  visCtx.beginPath();
  visCtx.moveTo(ax0 + arrow, cpY);
  visCtx.lineTo(ax0 + arrow + 7 * DPR, cpY - 6 * DPR);
  visCtx.lineTo(ax0 + arrow + 7 * DPR, cpY + 6 * DPR);
  visCtx.closePath();
  visCtx.fillStyle = "#ff85b5";
  visCtx.fill();

  // Texto fuerza
  if (arrow > 4 * DPR) {
    visCtx.fillStyle = "#ffb2d0";
    visCtx.font = `${13 * DPR}px Inter`;
    visCtx.fillText(`F ‚âà ${Fcur.toFixed(1)} N`, ax0 + arrow + 15, cpY - 10);
  }

  /* ----------------------------------------
     Actualizar etiquetas
  ---------------------------------------- */
  lvlEl.textContent = level.toFixed(2) + " m";
  pbaseEl.textContent = Math.round(pressureAt(level, rho, g)) + " Pa";
}

/* =======================================
   Gr√°fico de presi√≥n vs profundidad
======================================= */
function drawChart(level) {
  const p = readParams();
  const { rho, g, h, steps } = p;

  const W = chartCanvas.width;
  const H = chartCanvas.height;
  chartCtx.clearRect(0, 0, W, H);
  const DPR = window.devicePixelRatio || 1;

  // Fondo
  chartCtx.fillStyle = "rgba(20,15,30,0.8)";
  chartCtx.fillRect(0, 0, W, H);

  // M√°rgenes
  const ml = 50 * DPR,
    mr = 20 * DPR,
    mt = 20 * DPR,
    mb = 40 * DPR;

  const pw = W - ml - mr;
  const ph = H - mt - mb;

  // Ejes
  chartCtx.strokeStyle = "rgba(255,255,255,0.2)";
  chartCtx.beginPath();
  chartCtx.moveTo(ml, mt);
  chartCtx.lineTo(ml, mt + ph);
  chartCtx.lineTo(ml + pw, mt + ph);
  chartCtx.stroke();

  const Pmax = pressureAt(h, rho, g);

  // Curva
  chartCtx.beginPath();
  for (let i = 0; i <= steps; i++) {
    const f = i / steps;
    const depth = f * h;
    const P = pressureAt(depth, rho, g);
    const x = ml + ((P - P0) / (Pmax - P0)) * pw;
    const y = mt + f * ph;
    if (i === 0) chartCtx.moveTo(x, y);
    else chartCtx.lineTo(x, y);
  }
  chartCtx.strokeStyle = "#9ab3ff";
  chartCtx.lineWidth = 2.5 * DPR;
  chartCtx.stroke();

  // Punto actual
  const Pcur = pressureAt(level, rho, g);
  const xc = ml + ((Pcur - P0) / (Pmax - P0)) * pw;
  const yc = mt + (level / Math.max(h, 0.001)) * ph;

  chartCtx.beginPath();
  chartCtx.fillStyle = "#dff3ff";
  chartCtx.arc(xc, yc, 4 * DPR, 0, Math.PI * 2);
  chartCtx.fill();

  chartCtx.font = `${12 * DPR}px Inter`;
  chartCtx.fillStyle = "#eee";
  chartCtx.fillText(`${Math.round(Pcur)} Pa`, xc + 12, yc - 10);
}

/* =======================================
   Animaci√≥n principal
======================================= */
function animate(ts) {
  if (!lastTime) lastTime = ts;
  const dt = (ts - lastTime) / 1000;
  lastTime = ts;

  const p = readParams();
  const { speed, h } = p;

  if (animating) {
    currentLevel += dt * (h / (2.2 / speed));

    if (currentLevel >= h) {
      currentLevel = h;
      animating = false;
    }
  }

  drawSimulation(currentLevel);
  drawChart(currentLevel);

  requestAnimationFrame(animate);
}

// Iniciar animaci√≥n
requestAnimationFrame(animate);

/* =======================================
   Funci√≥n auxiliar ‚Äî rect√°ngulo redondeado
======================================= */
function roundRect(ctx, x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.arcTo(x + w, y, x + w, y + h, r);
  ctx.arcTo(x + w, y + h, x, y + h, r);
  ctx.arcTo(x, y + h, x, y, r);
  ctx.arcTo(x, y, x + w, y, r);
  ctx.closePath();
}

