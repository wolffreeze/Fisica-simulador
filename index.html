<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Simulador Hidrostático — Dark Purple Soft</title>
<style>
  :root{
    --bg1: #120c20;
    --bg2: #1d1433;
    --panel: #2a2040;
    --panel-2: #342745;
    --muted: #bfb4d9;
    --muted-2: #a899c6;
    --text: #efe9ff;
    --accent: #9ab3ff;
    --accent-2: #7df0c8;
    --glow: rgba(157,114,200,0.14);
    --shadow: 0 10px 30px rgba(10,8,18,0.6);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    min-height:100vh;
    background: linear-gradient(180deg,var(--bg1),var(--bg2));
    color:var(--text);
    padding:20px;
  }

  .app{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:320px 1fr;gap:20px}
  .panel{background:linear-gradient(180deg,var(--panel),var(--panel-2));border-radius:12px;padding:16px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,0.03)}
  .sidebar{height:calc(100vh - 40px);overflow:auto}
  h1{margin:0;font-size:18px;color:var(--text)}
  .muted{color:var(--muted);font-size:13px}
  .control{margin-top:12px}
  label{display:block;font-weight:600;font-size:13px;margin-bottom:6px;color:var(--muted-2)}
  input[type=number]{width:100%;padding:9px;border-radius:9px;border:1px solid rgba(255,255,255,0.04);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:var(--text)}
  input[type=range]{width:100%}
  .buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  button{cursor:pointer;border:0;padding:9px 12px;border-radius:9px;font-weight:700;background:transparent;color:var(--text)}
  .btn-primary{background:linear-gradient(90deg,var(--accent),#7fb8ff);color:#0b1b2b;box-shadow:0 6px 18px rgba(55,95,195,0.12)}
  .btn-soft{background:rgba(125,240,200,0.12);color:var(--accent-2)}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
  .small{font-size:13px;color:var(--muted)}
  .main{display:flex;flex-direction:column;gap:14px}
  .canvas-area{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
  #visCanvas{width:100%;height:460px;border-radius:10px;background:linear-gradient(180deg,#1b1230,#26173f)}
  #chartCanvas{width:360px;height:260px;border-radius:10px;background:linear-gradient(180deg,#241533,#2d1a3b)}
  .results{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  .result-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .result-card .label{font-size:12px;color:var(--muted-2)}
  .result-card .value{font-weight:800;font-size:18px;color:var(--text)}
  footer.small{color:var(--muted);margin-top:12px}

  @media(max-width:980px){
    .app{grid-template-columns:1fr;padding:12px}
    .sidebar{height:auto;order:2}
    .main{order:1}
    #chartCanvas{width:100%}
  }
</style>
</head>
<body>
  <div class="app">
    <aside class="panel sidebar">
      <h1>Simulador Hidrostático — Educativo</h1>
      <p class="muted" style="margin-top:6px">Simulación con curva P(h), llenado animado y cálculos en tiempo real.</p>

      <div class="control">
        <label for="rho">Densidad ρ (kg/m³)</label>
        <input id="rho" type="number" value="1000">
      </div>

      <div class="control">
        <label for="g">Gravedad g (m/s²)</label>
        <input id="g" type="number" value="9.81">
      </div>

      <div class="control">
        <label for="h">Altura h (m)</label>
        <input id="h" type="number" value="2">
      </div>

      <div class="control">
        <label for="area">Área A (m²)</label>
        <input id="area" type="number" value="1">
      </div>

      <div class="control">
        <label for="steps">Resolución</label>
        <input id="steps" type="range" min="8" max="120" value="40">
      </div>

      <div class="control">
        <label for="speed">Velocidad</label>
        <input id="speed" type="range" min="0.25" max="3" step="0.05" value="1">
        <div class="small">Velocidad: <span id="speedTxt">1.00x</span></div>
      </div>

      <div class="buttons">
        <button id="case1" class="btn-primary">Caso 1 (Agua)</button>
        <button id="case2" class="btn-soft">Caso 2 (Aceite)</button>
      </div>

      <div class="buttons">
        <button id="start" class="btn-primary">Iniciar</button>
        <button id="pauseResume" class="btn-ghost">Pausar</button>
        <button id="reset" class="btn-ghost">Reiniciar</button>
      </div>

      <div class="buttons">
        <button id="download" class="btn-soft">Descargar imagen</button>
        <button id="copy" class="btn-ghost">Copiar parámetros</button>
      </div>

      <footer class="small">Hecho para LRPD · 2025</footer>
    </aside>

    <main class="main panel">
      <div class="canvas-area">
        <div style="flex:1">
          <canvas id="visCanvas"></canvas>
          <div style="display:flex;justify-content:space-between;margin-top:10px">
            <div class="small">Nivel: <strong id="lvl">0.00 m</strong></div>
            <div class="small">Presión en base: <strong id="pbase">101325 Pa</strong></div>
          </div>
        </div>

        <div style="width:360px">
          <canvas id="chartCanvas"></canvas>
          <div style="margin-top:8px" class="small">Curva: Presión vs Profundidad</div>
        </div>
      </div>

      <div class="results">
        <div class="result-card"><div class="label">Presión (base)</div><div id="resP" class="value">—</div></div>
        <div class="result-card"><div class="label">Fuerza total</div><div id="resF" class="value">—</div></div>
        <div class="result-card"><div class="label">Centroide</div><div id="resHc" class="value">—</div></div>
        <div class="result-card"><div class="label">Parámetros</div><div id="resParams" class="small">—</div></div>
      </div>
    </main>
  </div>

<script>
/* ==========================
   SIMULADOR HIDROSTÁTICO
   ========================== */

(function(){
  const vis = document.getElementById('visCanvas');
  const chart = document.getElementById('chartCanvas');
  const ctx = vis.getContext('2d');
  const cctx = chart.getContext('2d');
  const DPR = window.devicePixelRatio || 1;

  const rhoEl = document.getElementById('rho');
  const gEl = document.getElementById('g');
  const hEl = document.getElementById('h');
  const areaEl = document.getElementById('area');
  const stepsEl = document.getElementById('steps');
  const speedEl = document.getElementById('speed');
  const speedTxt = document.getElementById('speedTxt');

  const startBtn = document.getElementById('start');
  const pauseBtn = document.getElementById('pauseResume');
  const resetBtn = document.getElementById('reset');
  const downloadBtn = document.getElementById('download');
  const copyBtn = document.getElementById('copy');

  const case1Btn = document.getElementById('case1');
  const case2Btn = document.getElementById('case2');

  const resP = document.getElementById('resP');
  const resF = document.getElementById('resF');
  const resHc = document.getElementById('resHc');
  const resParams = document.getElementById('resParams');
  const lvlLabel = document.getElementById('lvl');
  const pbaseLabel = document.getElementById('pbase');

  let anim = false;
  let last = null;
  let progress = 0;
  const P0 = 101325;
  const baseDuration = 2.2;

  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function fmt(x,unit){ return (Math.round(x*100)/100) + (unit?" "+unit:""); }

  function pressureAt(depth,rho,g){ return P0 + rho*g*depth; }
  function finalForce(rho,g,h,A){ return rho*g*(h/2)*A; }

  function resize(){
    vis.width = vis.clientWidth * DPR;
    vis.height = vis.clientHeight * DPR;

    chart.width = chart.clientWidth * DPR;
    chart.height = chart.clientHeight * DPR;

    draw();
    drawChart();
  }
  window.addEventListener('resize', resize);
  setTimeout(resize,80);

  /* === DIBUJO PRINCIPAL === */
  function draw(){
    const rho = +rhoEl.value;
    const g = +gEl.value;
    const h = +hEl.value;
    const A = +areaEl.value;
    const steps = +stepsEl.value;

    const W = vis.width, H = vis.height;
    ctx.clearRect(0,0,W,H);

    const pad = 30*DPR;
    const left = pad;
    const top = pad;
    const wBox = W*0.46;
    const hBox = H - pad*2;

    // Fondo
    ctx.fillStyle = "#1a1530";
    ctx.fillRect(left,top,wBox,hBox);

    // Nivel actual
    const level = progress * h;
    const frac = h===0 ? 0 : level/h;
    const hFill = frac * hBox;
    ctx.fillStyle = "#3fa9ff33";
    ctx.fillRect(left, top + (hBox - hFill), wBox, hFill);

    lvlLabel.textContent = level.toFixed(2)+" m";
    pbaseLabel.textContent = Math.round(pressureAt(level,rho,g))+" Pa";

    // Datos finales
    const Pbase = pressureAt(h,rho,g);
    const F = finalForce(rho,g,h,A);
    resP.textContent = fmt(Pbase,"Pa");
    resF.textContent = fmt(F,"N");
    resHc.textContent = fmt(h/2,"m");
    resParams.textContent = `ρ=${rho} kg/m³ · g=${g} · h=${h} m · A=${A} m²`;

    // Barras
    const barX = left + wBox + 20*DPR;
    const maxBar = W*0.22;
    ctx.fillStyle = "#ffffff33";

    for(let i=0;i<=steps;i++){
      const fr = i/steps;
      const depth = fr*h;
      const y = top + fr*hBox;
      const P = pressureAt(depth,rho,g);
      const rel = (P-P0)/(rho*g*h || 1);
      const bw = rel * maxBar * frac;

      ctx.fillRect(barX, y-3*DPR, bw, 6*DPR);

      if(i % Math.ceil(steps/6)===0){
        ctx.fillStyle="#ccc";
        ctx.fillText(depth.toFixed(2)+" m", barX + bw + 6*DPR, y);
        ctx.fillStyle="#aaa";
        ctx.fillText(Math.round(P)+" Pa", barX + bw + 75*DPR, y);
      }
      ctx.fillStyle="#ffffff33";
    }
  }

  /* === GRÁFICO === */
  function drawChart(){
    const W = chart.width, H = chart.height;
    cctx.clearRect(0,0,W,H);

    const rho = +rhoEl.value;
    const g = +gEl.value;
    const h = +hEl.value;
    const steps = +stepsEl.value;

    const ml=40*DPR, mr=20*DPR, mt=20*DPR, mb=30*DPR;
    const pw=W-ml-mr, ph=H-mt-mb;

    const Pmax = pressureAt(h,rho,g);

    // Fondo
    cctx.fillStyle="#25173a";
    cctx.fillRect(0,0,W,H);

    // Ejes
    cctx.strokeStyle="#ffffff22";
    cctx.beginPath();
    cctx.moveTo(ml,mt);
    cctx.lineTo(ml,mt+ph);
    cctx.lineTo(ml+pw,mt+ph);
    cctx.stroke();

    // Curva
    cctx.beginPath();
    for(let i=0;i<=steps;i++){
      const fr=i/steps;
      const depth=fr*h;
      const P=pressureAt(depth,rho,g);
      const x=ml + ((P-P0)/(Pmax-P0||1))*pw;
      const y=mt + fr*ph;
      if(i===0) cctx.moveTo(x,y);
      else cctx.lineTo(x,y);
    }
    cctx.strokeStyle="#9ab3ff";
    cctx.lineWidth=2*DPR;
    cctx.stroke();

    // Punto actual
    const level = progress*h;
    const fr = h===0?0:level/h;
    const Pcur = pressureAt(level,rho,g);
    const xcur = ml + ((Pcur-P0)/(Pmax-P0||1))*pw;
    const ycur = mt + fr*ph;

    cctx.fillStyle="#9ab3ff44";
    cctx.beginPath();
    cctx.arc(xcur,ycur,8*DPR,0,Math.PI*2);
    cctx.fill();

    cctx.fillStyle="#dff3ff";
    cctx.beginPath();
    cctx.arc(xcur,ycur,3*DPR,0,Math.PI*2);
    cctx.fill();

    cctx.fillStyle="#eee";
    cctx.fillText(Math.round(Pcur)+" Pa", xcur+10*DPR, ycur-10*DPR);
  }

  /* === LOOP === */
  function loop(ts){
    if(!last) last = ts;
    const dt = (ts-last)/1000;
    last = ts;

    const speed = +speedEl.value;
    speedTxt.textContent = speed.toFixed(2)+"x";

    if(anim){
      progress += dt/(2.2/speed);
      if(progress>=1){ progress=1; anim=false; }
    }

    draw();
    drawChart();

    requestAnimationFrame(loop);
  }

  /* === BOTONES === */
  startBtn.addEventListener('click', ()=>{
    if(!anim){
      if(progress>=1) progress=0;
      anim=true;
      last=performance.now();
    }
  });

  pauseBtn.addEventListener('click', ()=>{
    anim = !anim;
    last = performance.now();
    pauseBtn.textContent = anim ? "Pausar" : "Reanudar";
  });

  resetBtn.addEventListener('click', ()=>{
    anim=false;
    progress=0;
    last=null;
    pauseBtn.textContent="Pausar";
    draw();
    drawChart();
  });

  downloadBtn.addEventListener('click',()=>{
    const tmp=document.createElement('canvas');
    const w=vis.width+chart.width+20*DPR;
    const h=Math.max(vis.height,chart.height);
    tmp.width=w; tmp.height=h;
    const tctx=tmp.getContext('2d');
    tctx.fillStyle="#1b1230";
    tctx.fillRect(0,0,w,h);
    tctx.drawImage(vis,0,0);
    tctx.drawImage(chart,vis.width+20*DPR,0);
    const a=document.createElement('a');
    a.href=tmp.toDataURL();
    a.download="simulacion_hidrostatica.png";
    a.click();
  });

  copyBtn.addEventListener('click',()=>{
    const s=`rho=${rhoEl.value}, g=${gEl.value}, h=${hEl.value}, A=${areaEl.value}`;
    navigator.clipboard.writeText(s);
    copyBtn.textContent="Copiado ✓";
    setTimeout(()=>copyBtn.textContent="Copiar parámetros",1000);
  });

  case1Btn.addEventListener('click',()=>{
    rhoEl.value=1000; gEl.value=9.81; hEl.value=2; areaEl.value=1;
    progress=0; anim=true; last=performance.now();
  });

  case2Btn.addEventListener('click',()=>{
    rhoEl.value=850; gEl.value=9.81; hEl.value=1.5; areaEl.value=0.8;
    progress=0; anim=true; last=performance.now();
  });

  [rhoEl,gEl,hEl,areaEl,stepsEl,speedEl].forEach(el=>{
    el.addEventListener('input',()=>{
      if(progress>1) progress=1;
      draw(); drawChart();
    });
  });

  requestAnimationFrame(loop);
})();
</script>

</body>
</html>


